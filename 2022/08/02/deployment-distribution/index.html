<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Bring Deployment distribution experiment back | Zeebe Chaos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://camunda.github.io/zeebe-chaos/2022/08/02/deployment-distribution"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Bring Deployment distribution experiment back | Zeebe Chaos"><meta data-rh="true" name="description" content="We encountered recently a severe bug zeebe#9877 and I was wondering why we haven&#x27;t spotted it earlier, since we have chaos experiments for it. I realized two things:"><meta data-rh="true" property="og:description" content="We encountered recently a severe bug zeebe#9877 and I was wondering why we haven&#x27;t spotted it earlier, since we have chaos experiments for it. I realized two things:"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-08-02T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/ChrisKujawa"><meta data-rh="true" property="article:tag" content="availability"><link data-rh="true" rel="icon" href="/zeebe-chaos/img/zeebe-logo.png"><link data-rh="true" rel="canonical" href="https://camunda.github.io/zeebe-chaos/2022/08/02/deployment-distribution"><link data-rh="true" rel="alternate" href="https://camunda.github.io/zeebe-chaos/2022/08/02/deployment-distribution" hreflang="en"><link data-rh="true" rel="alternate" href="https://camunda.github.io/zeebe-chaos/2022/08/02/deployment-distribution" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://camunda.github.io/zeebe-chaos/2022/08/02/deployment-distribution","mainEntityOfPage":"https://camunda.github.io/zeebe-chaos/2022/08/02/deployment-distribution","url":"https://camunda.github.io/zeebe-chaos/2022/08/02/deployment-distribution","headline":"Bring Deployment distribution experiment back","name":"Bring Deployment distribution experiment back","description":"We encountered recently a severe bug zeebe#9877 and I was wondering why we haven't spotted it earlier, since we have chaos experiments for it. I realized two things:","datePublished":"2022-08-02T00:00:00.000Z","author":{"@type":"Person","name":"Christopher Kujawa","description":"Chaos Engineer @ Zeebe","url":"https://github.com/ChrisKujawa","image":"https://github.com/ChrisKujawa.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://camunda.github.io/zeebe-chaos/","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/zeebe-chaos/rss.xml" title="Zeebe Chaos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zeebe-chaos/atom.xml" title="Zeebe Chaos Atom Feed"><link rel="stylesheet" href="/zeebe-chaos/assets/css/styles.09e3c82e.css">
<script src="/zeebe-chaos/assets/js/runtime~main.325eedbb.js" defer="defer"></script>
<script src="/zeebe-chaos/assets/js/main.d6923f10.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zeebe-chaos/"><div class="navbar__logo"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Zeebe Chaos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zeebe-chaos/">Chaos Summaries</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/camunda/zeebe-chaos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/12/12/News-from-Camunda-Exporter-project">News from Camunda Exporter project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/11/14/Impact-of-Camunda-Exporter-on-processing-performance">Impact of Camunda Exporter on processing performance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/10/24/Camunda-Exporter-MVP">Camunda Exporter MVP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/10/14/Optimizing-cluster-sizing-using-a-real-world-benchmark">Optimizing cluster sizing using a real world benchmark</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/08/19/Operate-improve-import-latency">Improve Operate import latency</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/08/16/Operate-load-handling">Operate load handling</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/07/25/Using-flow-control-to-handle-bottlenecked-exporting">Using flow control to handle bottleneck on exporting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/07/25/Using-flow-control-to-handle-uncontrolled-process-loops">Using flow control to handle uncontrolled process loops</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2024/01/19/Job-Activation-Latency">Reducing the job activation delay</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/12/20/Broker-scaling-performance">Broker Scaling and Performance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/12/19/Dynamic-Scaling-with-Dataloss">Dynamic Scaling with Dataloss</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/12/18/Dynamically-scaling-brokers">Dynamically scaling brokers</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/12/06/Job-Push-resiliency">Job push resiliency</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/11/30/Job-push-overloading">Job push overloading</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/11/07/Hot-backups-impact-on-processing">Hot backups impact on processing</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/06/02/Using-Large-Multi-Instance">Using Large Multi-Instance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/05/19/Continuing-SST-Partitioning-toggle">Continuing SST Partitioning toggle</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/05/15/SST-Partitioning-toggle">SST Partitioning toggle</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/04/06/gateway-termination">Gateway Termination</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/02/23/Recursive-call-activity">Recursive call activity</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition">Message Correlation after Network Partition</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/zeebe-chaos/2022/08/02/deployment-distribution">Bring Deployment distribution experiment back</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS">Standalone Gateway in CCSaaS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/02/01/High-Snapshot-Frequency">High Snapshot Frequency</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/01/19/big-variables">Handling of Big Variables</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/11/24/Worker-count-should-not-impact-performance">Worker count should not impact performance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys">Not produce duplicate Keys</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/10/29/Throughput-on-big-state">Throughput on big state</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/10/05/recovery-time">Recovery (Fail Over) time</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/09/23/Old-Clients">Old-Clients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/07/06/Slow-Network">Slow Network</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/06/08/Full-Disk">Full Disk Recovery</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/05/25/Reset-Clock">Time travel Experiment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot">Corrupted Snapshot Experiment Investigation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering">BPMN meets Chaos Engineering</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/03/30/set-file-immutable">Set file immutable</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">Camunda Cloud network partition</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/03/09/cont-workflow-instance">Fault-tolerant processing of process instances</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/02/23/automate-deployments-dist">Automating Deployment Distribution Chaos Experiment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/01/26/deployments">Deployment Distribution</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/01/19/network-partition">Network partitions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower">Disconnect Leader and one Follower</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/11/24/message-correlation-after-failover">Message Correlation after Failover</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/11/11/job-timeouts">Many Job Timeouts</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/11/03/investigate-failing-tests">Investigate failing Chaos Tests</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/20/non-graceful-shutdown">Non-graceful Shutdown Broker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/27/standalone-gw-memory">Gateway memory consumption</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/13/multiple-leader-changes">Multiple Leader Changes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/06/toxi-proxy">Play around with ToxiProxy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud">Experiment with Camunda Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/08/06/low-load">Experiment with Low Load</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/30/experiment-without-exporters">Experiment without Exporters</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/16/big-multi-instance">Big Multi Instance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/09/timer-and-huge-variables">Experiment with Timers and Huge Variables</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/02/extract-k8-resources">Extract K8 resources from namespace</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/25/gateway-network-partition">Gateway Network Partition</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/18/correlate-message-after-failover">Correlate Message after failover</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/11/high-cpu-gateway">High CPU load on Standalone Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/04/first-chaos-day">First Chaos Day!</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Bring Deployment distribution experiment back</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-08-02T00:00:00.000Z">August 2, 2022</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/zeebe-chaos/authors/zell"><img class="avatar__photo authorImage_XqGP" src="https://github.com/ChrisKujawa.png" alt="Christopher Kujawa"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/zeebe-chaos/authors/zell"><span class="authorName_yefp">Christopher Kujawa</span></a></div><small class="authorTitle_nd0D" title="Chaos Engineer @ Zeebe">Chaos Engineer @ Zeebe</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>We encountered recently a severe bug <a href="https://github.com/camunda/camunda/issues/9877" target="_blank" rel="noopener noreferrer">zeebe#9877</a> and I was wondering why we haven&#x27;t spotted it earlier, since we have chaos experiments for it. I realized two things:</p>
<ol>
<li>The experiments only check for parts of it (BPMN resource only). The production code has changed, and a new feature has been added (DMN) but the experiments/tests haven&#x27;t been adjusted.</li>
<li>More importantly we disabled the automated execution of the deployment distribution experiment because it was flaky due to a missing standalone gateway in Camunda Cloud SaaS <a href="https://github.com/camunda/zeebe-chaos/issues/61" target="_blank" rel="noopener noreferrer">camunda/zeebe-chaos#61</a>. This is no longer the case, see <a href="/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS">Standalone Gateway in CCSaaS</a></li>
</ol>
<p>On this chaos day I want to bring the automation of this chaos experiment back to life. If I have still time I want to enhance the experiment.</p>
<p><strong>TL;DR;</strong> The experiment still worked, and our deployment distribution is still resilient against network partitions. It also works with DMN resources. I can enable the experiment again, and we can close <a href="https://github.com/camunda/zeebe-chaos/issues/61" target="_blank" rel="noopener noreferrer">camunda/zeebe-chaos#61</a>. Unfortunately, we were not able to reproduce <a href="https://github.com/camunda/camunda/issues/9877" target="_blank" rel="noopener noreferrer">zeebe#9877</a> but we did some good preparation work for it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="chaos-experiment">Chaos Experiment<a href="#chaos-experiment" class="hash-link" aria-label="Direct link to Chaos Experiment" title="Direct link to Chaos Experiment">​</a></h2>
<p>To recap, when a deployment is created by a client it is sent to the partition one leader. Partition one is in charge of distributing the deployment to the other partitions. That means it will send the deployment to the other partition leaders, this is retried as long no ACK was received from the corresponding partition leader.</p>
<p><img decoding="async" loading="lazy" alt="deploymentDistribution" src="/zeebe-chaos/assets/images/deploymentDistribution-d300fff30d9d6cab27d9fe01c6504cd4.png" width="871" height="491" class="img_ev3q"></p>
<p>We already have covered that in more detail in another chaos day you can read <a href="/zeebe-chaos/2021/01/26/deployments">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="expected">Expected<a href="#expected" class="hash-link" aria-label="Direct link to Expected" title="Direct link to Expected">​</a></h3>
<p><img decoding="async" loading="lazy" src="/zeebe-chaos/assets/images/deploymentDistributionExperiment-8f120f1fafbca4d31ecf2fb0f8e909ba.png" width="933" height="515" class="img_ev3q"></p>
<p>As you can see in the image we will create an asymmetric network partition and disconnect the partition one leader from partition three. That means the sending to partition three will not be possible. We use here an asymmetric network partition, in order to reduce the probability to cause a leader change. The partition one leader is a follower of partition three and will still receive heartbeats.</p>
<p>After disconnecting the leaders we deploy multiple process versions and after connecting the leaders again we expect that the deployments are distributed. It is expected that we can create instances of the last version on all partitions.</p>
<p>We will run the existing experiment against the latest minor version, to verify whether the experiment still works. When we enable the experiment again for automation it will be executed against SNAPSHOT automatically.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="actual">Actual<a href="#actual" class="hash-link" aria-label="Direct link to Actual" title="Direct link to Actual">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h4>
<p>As a first step, we created a new Production-S cluster, which has three partitions, three nodes (brokers), and two standalone gateways. The Zeebe version was set to 8.0.4 (latest minor).</p>
<p>It was a while since I used the <a href="https://chaostoolkit.org/" target="_blank" rel="noopener noreferrer">chaostoolkit</a> which is the reason I had to reinstall it again, which is quite a simple see <a href="https://chaostoolkit.org/reference/usage/install/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>TL;DR:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m venv ~/.venvs/chaostk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source  ~/.venvs/chaostk/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install -U chaostoolkit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chaos --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="executing-chaos-toolkit">Executing chaos toolkit<a href="#executing-chaos-toolkit" class="hash-link" aria-label="Direct link to Executing chaos toolkit" title="Direct link to Executing chaos toolkit">​</a></h4>
<p>As mentioned, the deployment distribution was not enabled for Production-S clusters, which is currently the only configuration we test via <a href="https://github.com/zeebe-io/zeebe-cluster-testbench" target="_blank" rel="noopener noreferrer">Zeebe Testbench</a>. We have to use the experiment that is defined under <a href="https://github.com/camunda/zeebe-chaos/tree/master/chaos-workers/chaos-experiments/camunda-cloud/production-l/deployment-distribution" target="_blank" rel="noopener noreferrer">production-l/deployment-distribution</a>, which is the same*.</p>
<sub>* That is not 100% true. During running the Production-l experiment I realized that it made some assumptions regarding the <a href="https://github.com/camunda/zeebe-chaos/blob/master/chaos-workers/chaos-experiments/scripts/disconnect-leaders-one-way.sh#L19">partition count</a> which needs to be adjusted for the Production-S setup.</sub>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> chaos run production-l/deployment-distribution/experiment.json </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Validating the experiment&#x27;s syntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Experiment looks valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Running experiment: Zeebe deployment distribution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Steady-state strategy: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Rollbacks strategy: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Steady state hypothesis: Zeebe is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Probe: All pods should be ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Steady state hypothesis is met!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Playing your experiment&#x27;s method now...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:25 INFO] Action: Enable net_admin capabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:26 WARNING] This process returned a non-zero exit code. This may indicate some error and not what you expected. Please have a look at the logs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:35:26 INFO] Pausing after activity for 180s...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:26 INFO] Probe: All pods should be ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:33 INFO] Action: Create network partition between leaders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:34 WARNING] This process returned a non-zero exit code. This may indicate some error and not what you expected. Please have a look at the logs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:34 INFO] Action: Deploy different deployment versions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:40 INFO] Action: Delete network partition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:42 INFO] Probe: Create process instance of latest version on partition one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:43 INFO] Probe: Create process instance of latest version on partition two</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:44 INFO] Probe: Create process instance of latest version on partition three</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:44 INFO] Steady state hypothesis: Zeebe is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:44 INFO] Probe: All pods should be ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:45 INFO] Steady state hypothesis is met!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:45 INFO] Let&#x27;s rollback...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:45 INFO] No declared rollbacks, let&#x27;s move on.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 09:38:45 INFO] Experiment ended with status: completed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Based on the tool output it looks like it succeed, to make sure it really worked, we will take a look at the logs in stackdriver.</p>
<p>In the following logs we can see that deployment distribution is failing for partition 3 and is retried, which is expected and what we wanted.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.114 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685347-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.115 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685347 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.157 CEST zeebe Received new exporter state {elasticsearch=228, MetricsExporter=228} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.157 CEST zeebe Received new exporter state {elasticsearch=228, MetricsExporter=228}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.241 CEST zeebe Received new exporter state {elasticsearch=232, MetricsExporter=232}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.241 CEST zeebe Received new exporter state {elasticsearch=232, MetricsExporter=232}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.464 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685351-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:53.466 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685351 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:54.216 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685353-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:54.218 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685353 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:54.224 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685355-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:54.225 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685355 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:55.055 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685359-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:55.057 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685359 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:55.689 CEST zeebe Received new exporter state {elasticsearch=299, MetricsExporter=299}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:55.690 CEST zeebe Received new exporter state {elasticsearch=299, MetricsExporter=299}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:56.089 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685357-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:56.090 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685357 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:56.272 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685363-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:56.273 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685363 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:56.920 CEST zeebe Failed to receive deployment response for partition 3 (on topic &#x27;deployment-response-2251799813685361-3&#x27;). Retrying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:38:56.922 CEST zeebe Deployment DISTRIBUTE command for deployment 2251799813685361 was written on partition 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-02 09:39:08.369 CEST zeebe Received new exporter state {elasticsearch=252, MetricsExporter=252}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>At some point, the retry stopped, and we can see in the experiment output that we were able to start process instances on all partitions. This is great because it means the experiment was successfully executed and our deployment distribution is failure tolerant.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enhancement">Enhancement<a href="#enhancement" class="hash-link" aria-label="Direct link to Enhancement" title="Direct link to Enhancement">​</a></h4>
<p>As described earlier the current experiment deploys a BPMN process model only. It looks like this:</p>
<p><img decoding="async" loading="lazy" alt="v1" src="/zeebe-chaos/assets/images/multiVersionModel-bae5089e350bb8e3ef1f11b3e01be25c.png" width="999" height="276" class="img_ev3q"></p>
<p>In order to make DMN part of the experiment, we change the service task to a <a href="https://docs.camunda.io/docs/components/modeler/bpmn/business-rule-tasks/" target="_blank" rel="noopener noreferrer">Business Rule task</a>.</p>
<p><img decoding="async" loading="lazy" alt="v2" src="/zeebe-chaos/assets/images/multiVersionModelv2-7fa903fb40c6a640222206e5922de001.png" width="999" height="276" class="img_ev3q"></p>
<p>The decision is really simple and just defines a static input and returns that as output.</p>
<p><img decoding="async" loading="lazy" alt="decision" src="/zeebe-chaos/assets/images/decision-3e1b9db140fbc19b0250ee1fd804a33d.png" width="1213" height="471" class="img_ev3q"></p>
<p>When we run our experiment and create process instances on all partitions the DMN needs to be available otherwise the execution would fail. Currently, we can&#x27;t specify a specific version of the DMN in the Business Rule Task (always the latest will be executed). Because of that, we will not deploy different DMN model versions, since it is currently not that easy to verify whether the right version was chosen.</p>
<p>After adjusting the model and adjusting the script, we run the experiment again.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ chaos run production-l/deployment-distribution/experiment.json </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:12 INFO] Validating the experiment&#x27;s syntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:12 INFO] Experiment looks valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:12 INFO] Running experiment: Zeebe deployment distribution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:12 INFO] Steady-state strategy: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:12 INFO] Rollbacks strategy: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:12 INFO] Steady state hypothesis: Zeebe is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:12 INFO] Probe: All pods should be ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:13 INFO] Steady state hypothesis is met!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:13 INFO] Playing your experiment&#x27;s method now...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:13 INFO] Action: Enable net_admin capabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:13 WARNING] This process returned a non-zero exit code. This may indicate some error and not what you expected. Please have a look at the logs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:05:13 INFO] Pausing after activity for 180s...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:14 INFO] Probe: All pods should be ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:14 INFO] Action: Create network partition between leaders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:16 WARNING] This process returned a non-zero exit code. This may indicate some error and not what you expected. Please have a look at the logs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:16 INFO] Action: Deploy different deployment versions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:25 INFO] Action: Delete network partition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:27 INFO] Probe: Create process instance of latest version on partition one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:27 INFO] Probe: Create process instance of latest version on partition two</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:28 INFO] Probe: Create process instance of latest version on partition three</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:29 INFO] Steady state hypothesis: Zeebe is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:29 INFO] Probe: All pods should be ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:29 INFO] Steady state hypothesis is met!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:29 INFO] Let&#x27;s rollback...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:29 INFO] No declared rollbacks, let&#x27;s move on.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-08-02 11:08:29 INFO] Experiment ended with status: completed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It succeeded as well.</p>
<p>Taking a look at Operate we can see some incidents.</p>
<p><img decoding="async" loading="lazy" alt="dmn-error" src="/zeebe-chaos/assets/images/dmn-error-422b88cf3273e715c442c76ecce338d9.png" width="1000" height="175" class="img_ev3q"></p>
<p>It seems the process instance execution runs into the Business Rule Task, but the DMN resource was not available on the partition.</p>
<p><img decoding="async" loading="lazy" alt="dmn-retry" src="/zeebe-chaos/assets/images/dmn-retry-665320690997b2566a40ac99505a2f84.png" width="2528" height="698" class="img_ev3q"></p>
<p>After retrying in Operate the incident was resolved, which means the DMN resource was distributed at that time.</p>
<p>We can adjust the experiment further to await the result of the process execution, but I will stop here and leave that for a later point.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="reproduce-our-bug">Reproduce our bug<a href="#reproduce-our-bug" class="hash-link" aria-label="Direct link to Reproduce our bug" title="Direct link to Reproduce our bug">​</a></h4>
<p>The current experiment didn&#x27;t reproduce the bug in <a href="https://github.com/camunda/camunda/issues/9877" target="_blank" rel="noopener noreferrer">zeebe#9877</a>, since the DMN resource has to be distributed multiple times. Currently, we create a network partition such that the distribution doesn&#x27;t work at all.</p>
<p><img decoding="async" loading="lazy" src="/zeebe-chaos/assets/images/deploymentDistributionExperimentV2-271448cf9bf1690fc24acdd0f89581d9.png" width="933" height="515" class="img_ev3q"></p>
<p>In order to reproduce our scenario, we can set the network partition in the other direction, such that the acknowledgment is not received by the leader one.</p>
<p>Adjusting the experiment (script) like this:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-retryUntilSuccess disconnect &quot;$leader&quot; &quot;$leaderTwoIp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+retryUntilSuccess disconnect &quot;$leaderTwo&quot; &quot;$leaderIp&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Should do the trick, but I was not yet able to reproduce the issue with 8.0.4. It seems we need to spend some more time reproducing the bug. But I think with today&#x27;s changes we already did a good step in the right direction, and we can improve based on that. I will create a follow-up issue to improve our experiment.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-work">Further Work<a href="#further-work" class="hash-link" aria-label="Direct link to Further Work" title="Direct link to Further Work">​</a></h2>
<p>Based on today&#x27;s outcome we can enable again the Deployment Distribution experiment for Production-S, such that is executed by Zeebe Testbench (our automation tooling). We can close <a href="https://github.com/camunda/zeebe-chaos/issues/61" target="_blank" rel="noopener noreferrer">camunda/zeebe-chaos#61</a></p>
<p>We should adjust our Chaos Worker implementation such that we also deploy DMN resources as we did in today&#x27;s Chaos Day, since the scripts we changed aren&#x27;t used in the automation.</p>
<p>I will create a follow-up issue to improve our experiment, so we can reproduce the critical bug.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="found-bugs">Found Bugs<a href="#found-bugs" class="hash-link" aria-label="Direct link to Found Bugs" title="Direct link to Found Bugs">​</a></h2>
<p><em>none</em></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zeebe-chaos/tags/availability">availability</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/camunda/zeebe-chaos/blob/master/chaos-days/blog/2022-08-02-deployment-distribution/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Message Correlation after Network Partition</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Standalone Gateway in CCSaaS</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chaos-experiment" class="table-of-contents__link toc-highlight">Chaos Experiment</a><ul><li><a href="#expected" class="table-of-contents__link toc-highlight">Expected</a></li><li><a href="#actual" class="table-of-contents__link toc-highlight">Actual</a></li></ul></li><li><a href="#further-work" class="table-of-contents__link toc-highlight">Further Work</a></li><li><a href="#found-bugs" class="table-of-contents__link toc-highlight">Found Bugs</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zeebe" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.camunda.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/Camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/camunda/zeebe-chaos/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Zeebe Chaos. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>