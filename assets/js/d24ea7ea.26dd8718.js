"use strict";(self.webpackChunkzell_chaos=self.webpackChunkzell_chaos||[]).push([[6346],{22336:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var s=n(46094),i=n(74848),r=n(28453);const a={layout:"posts",title:"Testing retention of historical PIs in Camunda 8.8",date:new Date("2025-10-31T00:00:00.000Z"),categories:["chaos_experiment","broker","exporter"],authors:"rodrigo"},o="Chaos Experiment Summary",d={authorsImageUrls:[void 0]},c=[{value:"Chaos experiment",id:"chaos-experiment",level:2},{value:"Expected Outcomes",id:"expected-outcomes",level:3},{value:"Setup",id:"setup",level:3},{value:"Experiment",id:"experiment",level:3},{value:"Results",id:"results",level:3},{value:"Participants",id:"participants",level:2}];function h(e){const t={a:"a",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Summary:"})}),"\n",(0,i.jsx)(t.p,{children:"With Camunda 8.8, a new unified Camunda Exporter is introduced that\ndirectly populates data records consumable by read APIs on the\nsecondary storage. This significantly reduces the time until eventually\nconsistent data becomes available on Get and Search APIs. It also removes unnecessary duplication across multiple indices due to the previous architecture."}),"\n",(0,i.jsx)(t.p,{children:"This architectural change prompted us to re-run the retention tests to compare\nPI retention in historical indexes under the same conditions as Camunda 8.7."}),"\n",(0,i.jsx)(t.p,{children:"The historical data refers to exported data from configured exporters, such as records of completed process instances, tasks, and events that are no longer part of the active (runtime) state but are retained for analysis, auditing, or reporting."}),"\n",(0,i.jsx)(t.p,{children:"The goal of this experiment is to compare the amount of\nPIs that we can retain in historical data between Camunda 8.7 and 8.8 running with the same hardware."}),"\n",(0,i.jsx)(t.h2,{id:"chaos-experiment",children:"Chaos experiment"}),"\n",(0,i.jsx)(t.h3,{id:"expected-outcomes",children:"Expected Outcomes"}),"\n",(0,i.jsx)(t.p,{children:"We expect significant retention improvements for the same hardware with the change to harmonized indexes, which reduce the duplication of similar\ndata."}),"\n",(0,i.jsx)(t.h3,{id:"setup",children:"Setup"}),"\n",(0,i.jsxs)(t.p,{children:["The experiment consists of using a ",(0,i.jsx)(t.a,{href:"https://github.com/camunda/camunda/blob/main/load-tests/load-tester/src/main/resources/bpmn/realistic/bankCustomerComplaintDisputeHandling.bpmn",children:"realistic benchmark"})," with our ",(0,i.jsx)(t.a,{href:"https://github.com/camunda/camunda-load-tests-helm",children:"Camunda\nload tests project"})," running on its own Kubernetes cluster. It uses a\nrealistic process containing a mix of BPMN symbols such as tasks, events,\nand call activities, including subprocesses."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"realistic-process-model",src:n(68696).A+"",width:"1781",height:"736"})}),"\n",(0,i.jsxs)(t.p,{children:["For this experiment, we used a ",(0,i.jsx)(t.a,{href:"https://docs.camunda.io/docs/components/best-practices/architecture/sizing-your-environment/#camunda-8-saas",children:"base size 1x cluster"}),"\nconsisting of the standard 3 brokers, 3 partitions, a replication factor of 3, and 3 ES pods, each with a disk size of 32GB, for a total of 96GB of storage in ES."]}),"\n",(0,i.jsx)(t.p,{children:'Our goal was to run the cluster at maximum sustained load until exporting slowed and backpressure appeared. We treated that point as the Elasticsearch "watermark" \u2014 the threshold where exporting becomes the bottleneck for the cluster. Once we reached this point, we note the disks usage, stopped creating new PIs and counted how many had been archived in the historical indices. That count represents the retention capacity for the given ES disks under maximum sustained load.'}),"\n",(0,i.jsx)(t.h3,{id:"experiment",children:"Experiment"}),"\n",(0,i.jsx)(t.p,{children:"The experiment involved using the realistic benchmarks and maintaining a stable rate of 5 PI/s (previously determined in other experiments), waiting several hours until backpressure was observed."}),"\n",(0,i.jsx)(t.p,{children:"After a few hours, backpressure began to build up, reaching single-digit percentage points. Grafana metrics confirmed that the backpressure resulted from a backlog of unexported records."}),"\n",(0,i.jsx)(t.p,{children:"The experiment was conducted twice to ensure the results were consistent."}),"\n",(0,i.jsx)(t.h3,{id:"results",children:"Results"}),"\n",(0,i.jsx)(t.p,{children:"The PI/s completion rate remained relatively stable, even as backpressure started to build. The rate stabilized between 4 and 5 PI/s."}),"\n",(0,i.jsx)(t.p,{children:"Disk usage after backpressure began:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{}),(0,i.jsx)(t.th,{children:"First run"}),(0,i.jsx)(t.th,{children:"Second run"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ES disk 1"}),(0,i.jsx)(t.td,{children:"74%"}),(0,i.jsx)(t.td,{children:"74%"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ES disk 2"}),(0,i.jsx)(t.td,{children:"61%"}),(0,i.jsx)(t.td,{children:"72%"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ES disk 3"}),(0,i.jsx)(t.td,{children:"55%"}),(0,i.jsx)(t.td,{children:"67%"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Average"}),(0,i.jsx)(t.td,{children:"63.3%"}),(0,i.jsx)(t.td,{children:"71%"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:"Number of completed historical PI/s:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"First run: 223,000 PIs"}),"\n",(0,i.jsx)(t.li,{children:"Second run: 255,000 PIs"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"As we approached 70% disk usage, we noticed some impact on performance resulting of backpressure from exporting.\nIn previous tests with version 8.7, we observed similar backpressure onset between 70% and 80% disk usage."}),"\n",(0,i.jsxs)(t.p,{children:["Given that backpressure can occur earlier than expected, we decided to lower the threshold for automatically increasing disk sizes in the ES PVCs in SaaS (this happens in increments of 16GB). ",(0,i.jsx)(t.a,{href:"https://github.com/camunda/camunda/issues/40168",children:"This threshold was reduced from 80% to 70%"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Moreover, when comparing these results to the ",(0,i.jsx)(t.a,{href:"https://docs.camunda.io/docs/8.7/components/best-practices/architecture/sizing-your-environment/#camunda-8-saas",children:"retention with version 8.7"}),", we observed a significant improvement in retention. This enhancement is attributed to the harmonized indexes and the elimination of duplicate document storage. In version 8.7, for the base 1x cluster with identical disk sizes in ES, the retention was around 75,000 PIs in historical indices. In contrast, we achieved 223,000 and 255,000 in this experiment, representing a 218% increase or 3.18 times larger retention, based on the average of both numbers."]}),"\n",(0,i.jsx)(t.p,{children:"Comparing the retention numbers of both versions we get:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Cluster size"}),(0,i.jsx)(t.th,{children:"1x"}),(0,i.jsx)(t.th,{children:"2x"}),(0,i.jsx)(t.th,{children:"3x"}),(0,i.jsx)(t.th,{children:"4x"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Camunda 8.7"}),(0,i.jsx)(t.td,{children:"75k"}),(0,i.jsx)(t.td,{children:"150k"}),(0,i.jsx)(t.td,{children:"225k"}),(0,i.jsx)(t.td,{children:"300k"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Camunda 8.8"}),(0,i.jsx)(t.td,{children:"239k"}),(0,i.jsx)(t.td,{children:"478k"}),(0,i.jsx)(t.td,{children:"717k"}),(0,i.jsx)(t.td,{children:"956k"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:"Following these results, we updated the retention values in version 8.8. This was done conservatively (we rounded down to 200k for the base configuration), considering the high variability of process models. The intention is to provide a general representation of an average process, establishing standard metrics for performance comparison across Camunda versions."}),"\n",(0,i.jsx)(t.h2,{id:"participants",children:"Participants"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"@rodrigo"}),"\n"]})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},68696:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/realistic-process-model-dc97d1094284a531e649fe21335a42f0.png"},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(96540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}},46094:e=>{e.exports=JSON.parse('{"permalink":"/zeebe-chaos/2025/10/31/Improvents-in-retention","editUrl":"https://github.com/camunda/zeebe-chaos/blob/master/chaos-days/blog/2025-10-31-Improvents-in-retention/index.md","source":"@site/blog/2025-10-31-Improvents-in-retention/index.md","title":"Testing retention of historical PIs in Camunda 8.8","description":"Summary:","date":"2025-10-31T00:00:00.000Z","tags":[],"readingTime":3.715,"hasTruncateMarker":false,"authors":[{"name":"Rodrigo Lopes","title":"Associate Software Engineer @ Zeebe","url":"https://github.com/rodrigo-lourenco-lopes","imageURL":"https://github.com/rodrigo-lourenco-lopes.png","key":"rodrigo","page":null}],"frontMatter":{"layout":"posts","title":"Testing retention of historical PIs in Camunda 8.8","date":"2025-10-31T00:00:00.000Z","categories":["chaos_experiment","broker","exporter"],"authors":"rodrigo"},"unlisted":false,"nextItem":{"title":"Resilience of dynamic scaling","permalink":"/zeebe-chaos/2025/10/02/Dynamic-Scaling-Resilience"}}')}}]);